<ion-header>
  <ion-navbar>
    <ion-title>
      维修列表
    </ion-title>
  </ion-navbar>
  <div class="nav_pet_header">
    <ion-segment [(ngModel)]="pet">
      <ion-segment-button value="status0" (click)="changeStatus(0)">
        待维修
        <span></span>
      </ion-segment-button>
      <ion-segment-button value="status1" (click)="changeStatus(1)">
        维修中
        <span></span>
      </ion-segment-button>
      <ion-segment-button value="status2" (click)="changeStatus(2)">
        已维修
        <span></span>
      </ion-segment-button>
      <ion-segment-button value="status3" (click)="changeStatus(3)">
        已撤销
        <span></span>
      </ion-segment-button>
    </ion-segment>
  </div>
</ion-header>

<div [@showAlertWrapper]="promptFlag" class="repair-list_prompt"
     ontouchmove="event.preventDefault();event.stopPropagation();">
  <div class="wrapper"></div>
  <ion-list [@showAlert]="promptFlag" class="content">
    <ion-item class="_item">
      <ion-label>联系电话：</ion-label>
      <ion-input [(ngModel)]="data.repairMobile" type="text" maxlength="11" clearInput></ion-input>
    </ion-item>
    <ion-item class="_item">
      <ion-textarea [(ngModel)]="data.repairDesc" maxlength="50" placeholder="维修内容"></ion-textarea>
    </ion-item>
    <div class="btn">
      <button (click)="promptFlag='back'" ion-button clear>取消</button>
      <button (click)="promptSubmit()" ion-button clear>确认</button>
    </div>
  </ion-list>
</div>

<ion-content class="repair-list" [ngSwitch]="pet">
  <ion-refresher
    (ionRefresh)="doRefresh($event)" pullMax="100">
    <ion-refresher-content refreshingText='刷新中...'>
    </ion-refresher-content>
  </ion-refresher>
  <ion-list *ngSwitchCase="'status0'" class="wrapper">
    <p class="point">总计<span>{{total}}</span>条</p>
    <ion-card *ngFor="let repair of list; let i = index">
      <div class="info">
        <span>机器内码</span>
        <span class="text">{{repair.machineCode}}</span>
      </div>
      <div class="info">
        <span>机器名称</span>
        <span class="text">{{repair.machineName}}</span>
      </div>
      <div class="info">
        <span>机器地址</span>
        <span class="text">{{repair.machineAddress}}</span>
      </div>
      <div class="info">
        <span>故障类型</span>
        <span class="text">{{repair.state}}</span>
      </div>
      <div class="info">
        <span>报修时间</span>
        <span class="text">{{repair.reportTime}}</span>
      </div>
      <div class="info">
        <span>报修描述</span>
        <span class="text">{{repair.reportDesc}}</span>
      </div>
      <div class="info">
        <span>报修人电话</span>
        <CommonPhone [phone]="repair.reportMobile"></CommonPhone>
      </div>
      <div class="img" *ngIf="repair.img">
        <button ion-item (click)="openSlides(repair.img)">
          <div class="box" *ngFor="let url of repair.img.split(',')">
            <img src="{{url}}"/>
          </div>
        </button>
      </div>
      <div class="btn">
        <button ion-button block color="primary" (click)="openSubmit(repair,index)">确认维修</button>
      </div>
    </ion-card>
  </ion-list>
  <ion-list *ngSwitchCase="'status1'" class="wrapper">
    <p class="point">总计<span>{{total}}</span>条</p>
    <ion-card *ngFor="let repair of list; let i = index">
      <div class="info">
        <span>机器内码</span>
        <span class="text">{{repair.machineCode}}</span>
      </div>
      <div class="info">
        <span>机器名称</span>
        <span class="text">{{repair.machineName}}</span>
      </div>
      <div class="info">
        <span>机器地址</span>
        <span class="text">{{repair.machineAddress}}</span>
      </div>
      <div class="info">
        <span>报修时间</span>
        <span class="text">{{repair.reportTime}}</span>
      </div>
      <div class="info">
        <span>故障类型</span>
        <span class="text">{{repair.state}}</span>
      </div>
      <div class="info">
        <span>维修开始时间</span>
        <span class="text">{{repair.startTime}}</span>
      </div>
      <div class="info">
        <span>维修内容</span>
        <span class="text">{{repair.repairDesc}}</span>
      </div>
      <div class="info">
        <span>维修人电话</span>
        <CommonPhone [phone]="repair.repairMobile"></CommonPhone>
      </div>
      <div class="img" *ngIf="repair.img">
        <button ion-item (click)="openSlides(repair.img)">
          <div class="box" *ngFor="let url of repair.img.split(',')">
            <img src="{{url}}"/>
          </div>
        </button>
      </div>
      <div class="btn">
        <button ion-button block color="primary" (click)="repairSuccess(repair,index)">维修完成</button>
      </div>
    </ion-card>
  </ion-list>
  <ion-list *ngSwitchCase="'status2'" class="wrapper">
    <p class="point">总计<span>{{total}}</span>条</p>
    <ion-card *ngFor="let repair of list; let i = index">
      <div class="info">
        <span>机器内码</span>
        <span class="text">{{repair.machineCode}}</span>
      </div>
      <div class="info">
        <span>机器名称</span>
        <span class="text">{{repair.machineName}}</span>
      </div>
      <div class="info">
        <span>机器地址</span>
        <span class="text">{{repair.machineAddress}}</span>
      </div>
      <div class="info">
        <span>报修时间</span>
        <span class="text">{{repair.reportTime}}</span>
      </div>
      <div class="info">
        <span>故障类型</span>
        <span class="text">{{repair.state}}</span>
      </div>
      <div class="info">
        <span>维修结束时间</span>
        <span class="text">{{repair.endTime}}</span>
      </div>
      <div class="info">
        <span>维修内容</span>
        <span class="text">{{repair.repairDesc}}</span>
      </div>
      <div class="info">
        <span>维修人电话</span>
        <CommonPhone [phone]="repair.repairMobile"></CommonPhone>
      </div>
      <div class="img" *ngIf="repair.img">
        <button ion-item (click)="openSlides(repair.img)">
          <div class="box" *ngFor="let url of repair.img.split(',')">
            <img src="{{url}}"/>
          </div>
        </button>
      </div>
    </ion-card>
  </ion-list>
  <ion-list *ngSwitchCase="'status3'" class="wrapper">
    <p class="point">总计<span>{{total}}</span>条</p>
    <ion-card *ngFor="let repair of list; let i = index">
      <div class="info">
        <span>机器内码</span>
        <span class="text">{{repair.machineCode}}</span>
      </div>
      <div class="info">
        <span>机器名称</span>
        <span class="text">{{repair.machineName}}</span>
      </div>
      <div class="info">
        <span>机器地址</span>
        <span class="text">{{repair.machineAddress}}</span>
      </div>
      <div class="info">
        <span>报修时间</span>
        <span class="text">{{repair.reportTime}}</span>
      </div>
      <div class="info">
        <span>故障类型</span>
        <span class="text">{{repair.state}}</span>
      </div>
      <div class="info">
        <span>撤销时间</span>
        <span class="text">{{repair.cancelTime}}</span>
      </div>
      <div class="info">
        <span>撤销描述</span>
        <span class="text">{{repair.cancelDesc}}</span>
      </div>
      <div class="info">
        <span>撤销人电话</span>
        <CommonPhone [phone]="repair.cancelMobile"></CommonPhone>
      </div>
      <div class="img" *ngIf="repair.img">
        <button ion-item (click)="openSlides(repair.img)">
          <div class="box" *ngFor="let url of repair.img.split(',')">
            <img src="{{url}}"/>
          </div>
        </button>
      </div>
    </ion-card>
  </ion-list>
  <ion-infinite-scroll
    *ngIf="list.length !== total" (ionInfinite)="doInfinite($event)">
    <ion-infinite-scroll-content loadingText="努力加载中...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
  <p class="no-data" *ngIf="list.length === total">{{list.length === 0 ? '没有相关记录~' : '没有更多记录了~'}}</p>
</ion-content>
